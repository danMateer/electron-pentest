# Code Execution from Untrusted Content

# [OWASP Desktop App Security Top 10 (2021) Risk](https://github.com/OWASP/www-project-desktop-app-security-top-10/blob/main/tab_detaileddescription.md#owasp-top-10-desktop-application-security-risks-2021--detailed-description)
OWASP Top 10 2021 DA6: Security Misconfiguration

# Description
By default, Electron renderers can use Node.js primitives. For instance, a remote untrusted domain rendered in a browser window could invoke Node.js APIs to execute native code on the user’s machine. Similarly, a Cross-Site Scripting (XSS) vulnerability on a website can lead to remote code execution. To display remote content, `nodeIntegration` should be disabled in the `webPreferences` of `BrowserWindow` and `webview` tag.

# Instruction
"`nodeIntegration` and `nodeIntegrationInWorker are boolean options that can be used to determine whether node integration is enabled.

For `BrowserWindow`, default is **true**. If the option is not present, or is set to `true/1`, `nodeIntegration` is enabled as in the following examples:
```
mainWindow = new BrowserWindow({
 ""webPreferences"": {
 ""nodeIntegration"": true,
 “nodeIntegrationInWorker"": 1
 }
 });
```
Or simply:
```
mainWindow = new BrowserWindow()
```
For the `webview tag, default is **false**. When this attribute is present, the guest page in webview will have node integration:
```
<webview src=“https://example.com/“ nodeintegration></webview>
```
When sanbox is enabled (see below), `nodeintegration` is disabled.

Please note that it is also possible to use the `will-attach-webview` event to verify (and potentially change) any attribute of `webPreferences`. This event is emitted when a webview is being attached to the web content.

Since this mechanism can be used to change the `webPreferences` configuration, please carefully review the implementation of the callback. At the same time, this is a powerful mechanism to validate all settings and ensure a secure instance of `webview`, as demonstrated in this implementation:
```
app.on('web-contents-created', (event, contents) => {
 contents.on('will-attach-webview', (event, webPreferences, params) => {
   // Strip away preload scripts if unused
   // Alternatively, verify their location if legitimate
   delete webPreferences.preload
   delete webPreferences.preloadURL
   
  // Disable node integration
  webPreferences.nodeIntegration = false
 
  // Verify URL being loaded
   if (!params.src.startsWith('https://example.com/')) {
    event.preventDefault()
    }
  })
})
```

_[Source](https://doyensec.com/resources/us-17-Carettoni-Electronegativity-A-Study-Of-Electron-Security-wp.pdf)_

**Tools**
- [Electronegativity](https://github.com/doyensec/electronegativity)

**Additional References**
- [As It Stands - Electron Security](https://blog.scottlogic.com/2016/03/09/As-It-Stands-Electron-Security.html)
