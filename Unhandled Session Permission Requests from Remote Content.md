# Unhandled Session Permission Requests from Remote Content

# [OWASP Desktop App Security Top 10 (2021) Risk](https://github.com/OWASP/www-project-desktop-app-security-top-10/blob/main/tab_detaileddescription.md#owasp-top-10-desktop-application-security-risks-2021--detailed-description)
OWASP Top 10 2021 DA2: Broken Authentication and Session Management

# Description
When loading remote untrusted content, it is recommended to enable `Session`’s permissions handler, which can be used to respond to permission requests. 

This setting can be used to limit the exploitability in applications that load remote content. Not enforcing custom checks for permission requests (media, geolocation, notifications, midiSysex, pointerLock, fullscreen, openExternal) leaves the browser session under full control of the remote origin.

# Instruction
It is possible to access the  session  of existing pages by using the  session property of `WebContents`, or from the `session` module:
```
win = new BrowserWindow()
win.loadURL('https://example.com')

ses = win.webContents.session
console.log(ses.getUserAgent()) 
```

Using `setPermissionRequestHandler`, it is possible to write custom code to limit specific permissions (e.g. `openExternal`) in response to events from particular origins:
```
ses.setPermissionRequestHandler((webContents, permission, callback) => {
 if (webContents.getURL() !== ‘https://example.com’ && permission === 'openExternal') {
  return callback(false)
 } else {
  return callback(true)
 }}) 
```

Look for occurrences of `setPermissionRequestHandler`. If used, evaluate the implementation and security of the custom callback. If not used, the application does not limit session permissions at all.

_[Source](https://doyensec.com/resources/us-17-Carettoni-Electronegativity-A-Study-Of-Electron-Security-wp.pdf)_

**Tools**
- [Electronegativity](https://github.com/doyensec/electronegativity)

**Additional Resources**
- [Electron Security: Handle session permission requests from remote content](https://www.electronjs.org/docs/latest/tutorial/security#5-handle-session-permission-requests-from-remote-content)
