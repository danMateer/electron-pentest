# Insecure Communication

# [OWASP Desktop App Security Top 10 (2021) Risk](https://github.com/OWASP/www-project-desktop-app-security-top-10/blob/main/tab_detaileddescription.md#owasp-top-10-desktop-application-security-risks-2021--detailed-description)
OWASP Top 10 2021 DA7: Insecure Communication

# Description
HTTP, Mixed Content and TLS validation opt-out should not be used, as it makes possible to sniff and tamper the user’s traffic. 

If `nodeIntegration` is also enabled, an attacker can inject malicious JavaScript and compromise the user’s host.

# Instruction
**HTTP**

Search for resources loaded using http like:
```
win = new BrowserWindow(...);
win.loadURL('http://example.com/');
```

**Mixed Content**

Search for `allowRunningInsecureContent` set to `true/1` within the `webPreferences` of `BrowserWindow` or in the `webview` tag:
```
mainWindow = new BrowserWindow({
 ""webPreferences"": {
  ""allowRunningInsecureContent"": true
  }
 });

< webview src=""https://example.com "" webpreferences=“allowRunningInsecureContent”></webview>
```

**Insecure TLS Validation**
Verify that the application does not explicitly opt-out from TLS validation. Look for occurrences of `certificate-error` and `setCertificateVerifyProc`:
```
app.on('certificate-error', (event, webContents, url, error, certificate,
callback) => {
 if (url === 'https://example.com') {
  callback(true) //Go ahead anyway
 } else {
  callback(false)
 }}) 

win.webContents.session.setCertificateVerifyProc((request, callback) => {
 const {hostname} = request
 if (hostname === ‘example.com') {
  callback(0) //success and disables certificate verification
 } else {
  callback(-3) //use the verification result from chromium
 }})
```

Additionally, verify custom TLS certificates imported  into the platform certificate store with `app.importCertificate(options, callback)`.

_[Source](https://doyensec.com/resources/us-17-Carettoni-Electronegativity-A-Study-Of-Electron-Security-wp.pdf)_

**Tools**
- [Electronegativity](https://github.com/doyensec/electronegativity)

**Additional Resources**
- [Electron Security: Do not enable allowRunningInsecureContent](https://www.electronjs.org/docs/latest/tutorial/security#6-do-not-disable-websecurity)
